---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# quasardb

:warning:**WARNING**: Early stage development version. Use at your own risk.

:information_source:**NOTE**: Only :apple:macOS is currently supported.

The quasardb package is the official R API for [quasardb](https://www.quasardb.net) timeseries database.

## Installation

<!-- TODO:
You can install the released version from CRAN with:
```{r installation, eval = FALSE}
install.packages("quasardb")
```
-->

You can install quasardb from [GitHub](https://github.com/bureau14/qdb-api-r) with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("bureau14/qdb-api-r")
```

```{r include = FALSE}
# default values
knitr::opts_chunk$set(message = TRUE, warning = TRUE)
```

### quasardb C API

To build the R API, you will need the C API. It can either be installed on the machine (e.g. on UNIX in `/usr/lib` or `/usr/local/lib`) or you can unpack the C API archive in `inst` directory. You can get the C API as well as other tools from [our download page](https://www.quasardb.net/-Get-).

### Building the extension from source

To perform a clean build:
```{r eval = FALSE}
devtools::build(binary = TRUE)
```

To update documentation and auto-generated files:
```{r eval = FALSE}
devtools::document()
```

Only update the documentation in man, but don't regenerate R files:
```{r eval = FALSE}
roxygen2::roxygenize()
```

To check the extension:
```{r eval = FALSE}
devtools::check(check_version = TRUE)
```

You may wish to skip tests using:
```{r eval = FALSE}
devtools::check(check_version = TRUE, args = "--no-tests")
```

To test the extension:
```{r eval = FALSE}
devtools::test()
```

## Usage

```{r message = FALSE, warning = FALSE}
library(quasardb)
```

Get underlying C API version:

```{r example-version}
qdb_version()
```

Get underlying C API build id:
```{r example-build, eval = FALSE}
qdb_build()
```

Connect to a quasardb cluster at default URI:
```{r example-connect-default, eval = FALSE}
handle <- qdb_connect("qdb://127.0.0.1:2836")
```

Create a timeseries:
```{r example-ts_create, eval = FALSE}
handle <- qdb_connect("qdb://127.0.0.1:2836")
# Get all entries (precisely: their keys) tagged with 'my-tag' being timeseries.
qdb_ts_create(handle, name = "timeseries1",
     columns = c("column1" = ColumnType$Blob, "column2" = ColumnType$Double))
```

Get all entry keys matching given find query:
```{r example-find, eval = FALSE}
handle <- qdb_connect("qdb://127.0.0.1:2836")
# Get all entries (precisely: their keys) tagged with 'my-tag' being timeseries.
keys <- qdb_find(handle, "find(tag='my_tag' and type=ts)")
```

Execute a select query:
```{r example-query, eval = FALSE}
handle <- qdb_connect("qdb://127.0.0.1:2836")
# Get all entries tagged with 'my-tag' being timeseries.
result <-
  qdb_query(handle, "select count(*) from my_ts in range(2017, +1y)")
```

## TODO

 - Make compliant with other OSes: Linux, Windows, FreeBSD.
 - Add a default parameter to `qdb_connect`.
 - Make a quasardb driver compliant with [DBI package](https://www.rdocumentation.org/packages/DBI/).
